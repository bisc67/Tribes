#include "StdAfx.h"
#include "PumpThread.h"

using namespace WONAPI;
///////////////////////////////////////////////////////////////////////////////
///////////////////////////////////////////////////////////////////////////////
PumpThread::PumpThread(HWND theWnd, WONAPI::WONAPICore *theAPI)
{
	mWnd = theWnd;
	mAPI = theAPI;
	mOwnAPI = false;
	if(mAPI==NULL)
	{
		mAPI = new WONAPICore(false);
		mOwnAPI = true;
	}
}

///////////////////////////////////////////////////////////////////////////////
///////////////////////////////////////////////////////////////////////////////
PumpThread::~PumpThread()
{
	Stop();
	if(mOwnAPI)
		delete mAPI;
}

///////////////////////////////////////////////////////////////////////////////
///////////////////////////////////////////////////////////////////////////////
void PumpThread::WindowProcNotify()
{
	::PostMessage(mWnd,MSG_SIGNAL_PUMP_THREAD,0,0);
	mAPI->Pump(0);
}

///////////////////////////////////////////////////////////////////////////////
///////////////////////////////////////////////////////////////////////////////
void PumpThread::ThreadFunc()
{
	while(true)
	{
		if(mAPI->WaitTillNeedPump(20))
		{
			::PostMessage(mWnd,MSG_PUMP_API,0,0);
			mSignalEvent.WaitFor(INFINITE);
		}

		if(mStopped)
			return;
	}
}
